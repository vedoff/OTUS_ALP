# Сетевая лаборатория.
Дано

https://github.com/erlong15/otus-linux/tree/network \
(ветка network) \
Vagrantfile с начальным построением сети

    inetRouter
    centralRouter
    centralServer
   ## Планируемая архитектура
    построить следующую архитектуру Сеть office1
    192.168.2.0/26 - dev
    192.168.2.64/26 - test servers
    192.168.2.128/26 - managers
    192.168.2.192/26 - office hardware Сеть office2
    192.168.1.0/25 - dev
    192.168.1.128/26 - test servers
    192.168.1.192/26 - office hardware Сеть central
    192.168.0.0/28 - directors
    192.168.0.32/28 - office hardware
    192.168.0.64/26 - wifi 
    
Office1 ---\ \
             ----> Central --IRouter --> internet \
Office2----/

   ## Итого должны получится следующие сервера
    inetRouter
    centralRouter
    office1Router
    office2Router
    centralServer
    office1Server
    office2Server
    
### [Теоретическая часть](https://github.com/vedoff/netlab#1-%D1%82%D0%B5%D0%BE%D1%80%D0%B5%D1%82%D0%B8%D1%87%D0%B5%D1%81%D0%BA%D0%B0%D1%8F-%D1%87%D0%B0%D1%81%D1%82%D1%8C)
Найти свободные подсети \
Посчитать сколько узлов в каждой подсети, включая свободные \
Указать broadcast адрес для каждой подсети \
проверить нет ли ошибок при разбиении \
### [Практическая часть](https://github.com/vedoff/netlab/blob/main/README.md#%D0%BF%D1%80%D0%B0%D0%BA%D1%82%D0%B8%D1%87%D0%B5%D1%81%D0%BA%D0%B0%D1%8F-%D1%87%D0%B0%D1%81%D1%82%D1%8C-1)
Соединить офисы в сеть согласно схеме и настроить роутинг \
Все сервера и роутеры должны ходить в инет черз inetRouter \
Все сервера должны видеть друг друга у всех новых серверов отключить дефолт на нат (eth0), \
который вагрант поднимает для связи при нехватке сетевых интервейсов добавить по несколько адресов на интерфейс
    
# 1. Теоретическая часть
В теоретической части нам необходимо продумать топологию сети, а также: 
- Найти свободные подсети
- Посчитать количество узлов в каждой подсети, включая свободные
- Указать Broadcast-адрес для каждой подсети
- Проверить, нет ли ошибок при разбиении

Первым шагом мы рассмотрим все сети, указанные в задании. \
Посчитаем для них количество узлов, найдём Broadcast-адрес, проверим, нет ли ошибок при разбиении. \
Расчеты можно выполнить вручную, или воспользоваться калькулятором сетей. Для примера, посчитаем одну подсеть вручную: \
У нас есть сеть directors 192.168.0.0/28 \
192.168.0.0 — это сама сеть, 28 — это маска. \
Маска показывает нам, границы сети 192.168.0.0. Маска может быть записана в 2-х видах:
1) `/28`
2) `255.255.255.240` 

Пример перевода маски `/28` в формат `255.255.255.240`: \
Маска Ipv4-адреса — это 4 октета, т.е. 4 блока по 8 цифр (1 или 0). \
/28 — это 28 единиц с начала маски: \
`11111111.11111111.11111111.11110000` \
Всегда при разбиении сетей, после знака / указывается количество единиц с начала маски. \
`11111111.11111111.11111111.11110000` — это двоичный код маски, если мы переведем данное значение в деситеричную систему 
счисления, то получим `255.255.255.240` \
Далее посчитаем количество устройств в сети: \
Количество устройств в сети рассчитывается по формуле \
`= 2^(32−маска) − 2` \
Таким образом, количество устройств для подсети /28 будет \
`= 2^( 32−28 ) − 2 = 16 − 2 = 14` \
Цифра 2 вычитается, так как:
- Первый адрес (192.168.0.0) — это наименование подсети, его нельзя задать устройству
- Последний адрес (192.168.0.15) — это всегда broadcast-адрес. \
Broadcast-адрес нужен для рассылки всем устройствам сети. \
Таким образом мы можем сформировать таблицу топологии нашей сети

![image](https://user-images.githubusercontent.com/92672435/163796065-cd9e36c6-d4e0-41cc-8f83-aec559769731.png)

# Схема сети на основании полученых данных
![](https://github.com/vedoff/netlab/blob/main/pict/Screenshot%20from%202022-04-18%2012-53-19.png)
## На основании этой схемы мы получаем готовый список серверов
![image](https://user-images.githubusercontent.com/92672435/163784159-66625e55-66b7-4a21-a968-8571a95adb1d.png)
# Практическая часть
- Соединить офисы в сеть согласно схеме и настроить роутинг \
`vagrant up && ansible-playbook route-play.yml`
- Все сервера и роутеры должны ходить в инет черз inetRouter 
- Все сервера должны видеть друг друга у всех новых серверов отключить дефолт на нат (eth0), \
который вагрант поднимает для связи при нехватке сетевых интервейсов добавить по несколько адресов на интерфейс
#### Привожу только ключевые моменты.
![](https://github.com/vedoff/netlab/blob/main/pict/Screenshot%20from%202022-04-18%2016-14-30.png)
![](https://github.com/vedoff/netlab/blob/main/pict/Screenshot%20from%202022-04-18%2016-14-43.png)
![](https://github.com/vedoff/netlab/blob/main/pict/Screenshot%20from%202022-04-18%2016-09-05.png)
![](https://github.com/vedoff/netlab/blob/main/pict/Screenshot%20from%202022-04-18%2016-15-08.png)
![](https://github.com/vedoff/netlab/blob/main/pict/Screenshot%20from%202022-04-18%2016-09-29.png)
![](https://github.com/vedoff/netlab/blob/main/pict/Screenshot%20from%202022-04-18%2016-15-57.png)
